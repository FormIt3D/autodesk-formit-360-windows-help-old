# 2.6 – Nœuds Dynamo FormIt

_FormIt est fourni avec une bibliothèque de nœuds Dynamo qui transfèrent la géométrie entre FormIt et Dynamo. Dans les chapitres précédents, nous avons vu comment les objets Dynamo peuvent être créés et ajustés dynamiquement dans FormIt. Dans ce chapitre, nous allons modifier un graphique Dynamo fourni pour créer une version modifiée du graphique d’escalier OOTB._

_Dans ce chapitre, nous allons utiliser le modèle_ _**Encode Campus Sample Model.axm**_ _et le_ _script Dynamo_ _**Stairs by Top Edge.dyn**_ _. Si ce n’est pas déjà fait, téléchargez ces deux fichiers à partir du dossier_ _**FormIt Primer Part 2 Datasets** (Jeux de données de la partie II du guide FormIt Primer)._

_Si vous n’avez jamais utilisé Dynamo dans FormIt, nous vous recommandons de suivre les instructions du chapitre_ _**1.10 -**_ _**Computational Groups with Dynamo **_ _(Groupes informatiques avec Dynamo) de la_ _**partie I**_ _de ce guide. Bien que ce chapitre concerne la modification des graphiques Dynamo, il ne traite que des éléments de Dynamo liés aux nœuds spécifiques de FormIt. Si vous utilisez Dynamo pour la première fois, consultez le site_ [_**Dynamo Primer**_](https://primer.dynamobim.org/fr/01_Introduction/1-2_what_is_dynamo.html) _pour en savoir plus._

_**FormIt pour Windows 2022.0 ou version ultérieure est nécessaire pour cette section.**_

## **Ajout d’un emplacement de bibliothèque Dynamo**

_Même si FormIt est fourni avec une bibliothèque de graphiques OOTB dans le dossier **Dynamo Samples** (Échantillons Dynamo), vous devez disposer d’un emplacement pour créer et enregistrer vos propres graphiques personnalisés. Pour ce faire, nous allons d’abord ajouter un nouveau dossier aux **emplacements des bibliothèques Dynamo** de FormIt. Cette opération est similaire à l’ajout d’un dossier à la bibliothèque de contenu de FormIt. Si vous avez besoin de vous rafraîchir la mémoire, consultez le chapitre **1.11 – Importation de modèles avec la bibliothèque de contenu** de la partie I du guide._

1 – Pour ajouter un nouvel **emplacement de bibliothèque Dynamo**, procédez comme suit :

1. Ouvrez le fichier **Encode Campus Sample Model.axm** et accédez à la **palette Dynamo**.
2. Cliquez sur le bouton **Lier le répertoire Dynamo** situé dans le coin supérieur gauche.
3. La fenêtre **Préférences** s’affiche et l’onglet **Dynamo** s’ouvre automatiquement. Cliquez sur l’icône « plus » **Ajouter un emplacement à la bibliothèque Dynamo**.
4. Accédez à l’emplacement où vous avez téléchargé le dossier **Encode Model Data Set** (Jeu de données Modèle Encode) et sélectionnez le dossier **Support Files** > **FormIt Primer Graphs** (Fichiers de support > Graphiques FormIt Primer).
5. Cliquez sur **Sélectionner un dossier**, puis sur **OK**. Vous revenez alors à FormIt.
6. Dans la liste déroulante de dossiers située dans la partie supérieure de la **palette Dynamo**, sélectionnez le dossier **FormIt Primer Graphs** (Graphiques FormIt Primer) que vous venez d’ajouter.

![](../../.gitbook/assets/0%20%2821%29.png)

## **Nœud** **SendToFormIt**

_Pour qu’un graphique Dynamo fonctionne avec FormIt, il doit comporter au moins un nœud_ _**SendToFormIt**_ _._

1 – Tout d’abord, utilisez le graphique **Stairs by Top Edge** (Escalier jusqu’au bord supérieur) tel quel, à partir du dossier que vous venez d’ajouter.

1. Pour commencer, accédez à la scène Section – Longitudinal (Section – Longitudinale).

2 – Ensuite, ajoutez le nœud **SendToFormIt** au graphique. Pour ce faire, utilisez « Modifier le graphique source » dans un nouveau modèle FormIt afin de ne pas polluer le modèle de travail avec les modifications apportées à la création de graphiques.

1. Cliquez avec le bouton droit de la souris sur l’**icône FormIt** dans la barre des tâches, puis choisissez **FormIt** pour ouvrir une nouvelle fenêtre FormIt vide \(ou cliquez simplement avec le bouton du milieu de la souris sur l’icône FormIt\).
2. Dans la **palette Dynamo**, recherchez la mosaïque **Stairs by Top Edge** (Escalier jusqu’au bord supérieur), puis cliquez sur la petite flèche déroulante située sur le côté droit de la mosaïque ou cliquez avec le bouton droit de la souris sur la mosaïque.
3. Sélectionnez **Modifier le graphique source**. Cette opération lance automatiquement Dynamo et ouvre le graphique à modifier.

![](../../.gitbook/assets/2%20%2822%29.png)

2 – Une fois que Dynamo et le graphique sont ouverts, effectuez un zoom avant sur la zone affichée ci-dessous, qui contient les groupes vert et violet les plus à droite.

![](../../.gitbook/assets/3%20%2819%29.png)

_**Remarque :**_ _les graphiques Dynamo s’affichent de gauche à droite, c’est-à-dire que vous trouverez généralement les nœuds de sortie sur le côté droit du graphique._

3 –Vous devez à présent ajouter un nœud **SendToFormIt** pour envoyer la géométrie de l’escalier que vous voyez en arrière-plan dans votre modèle FormIt :

1. Dans la zone Modules complémentaires \(packages\) située à gauche, développez la liste déroulante **FormIt**, puis cliquez sur **SendToFormIt**. Un nœud **SendToFormIt** apparaît au centre de l’écran.
2. Pour ajouter le nouveau nœud au groupe violet **Send Stair Geometry to FormIt** (Envoyer la géométrie de l’escalier vers FormIt), sélectionnez le groupe violet et le nouveau nœud **SendToFormIt**, puis cliquez avec le bouton droit de la souris sur le nœud **SendToFormIt** et sélectionnez **Ajouter au groupe**. Déplacez le nouveau nœud vers un emplacement similaire à celui indiqué dans l’image ci-dessous.
3. Cliquez avec le bouton droit de la souris sur le nœud **SendToFormIt** et assurez-vous que l’option **Est une sortie** est sélectionnée. Elle est normalement sélectionnée par défaut, mais si ce n’est pas le cas, aucune géométrie n’est envoyée à FormIt.
4. Remplacez le nom du nœud **SendToFormIt** par **SendToFormIt.Stairs**.
5. Connectez les deux entrées \(2\) du nouveau nœud **SendToFormIt.Stairs**, comme illustré dans l’image ci-dessous.

![](../../.gitbook/assets/4%20%2818%29.png)

_**Remarque :**_ _bien que nous utilisions uniquement le nœud d’options_ _**SetAsMesh**_ _, qui détermine si la géométrie est envoyée vers FormIt en tant qu’objet ou en tant que maillage,_ _un certain nombre de nœuds_ _**FormItGroupOptions**_ _sont disponibles. Chaque nœud contrôle différentes propriétés de la géométrie envoyée à FormIt. N’hésitez pas à tester d’autres propriétés !_

4 – Revenons à FormIt et vérifions si ça a marché :

1. Enregistrez Dynamo, puis fermez-le. Le graphique mis à jour est rechargé automatiquement dans FormIt.
2. Revenez à la fenêtre FormIt avec le **fichier d’exemple Encode Campus** et, dans la **palette Dynamo**, cliquez à nouveau sur **Stairs by Top Edge** (Escalier jusqu’au bord supérieur).
3. Placez l’escalier dans le modèle, de la même façon que dans l’image ci-dessous.
4. Sélectionnez l’escalier et notez que son nom de groupe correspond au nom du graphique Dynamo.
5. À présent, double-cliquez pour modifier le groupe et sélectionnez le groupe de géométrie de l’escalier imbriqué. Notez que le nom de ce groupe correspond au nom donné au nœud dans Dynamo.

![](../../.gitbook/assets/5%20%2817%29.png)

_**Remarque :**_ _ne vous inquiétez pas de l’emplacement exact de l’escalier, nous allons l’ajuster dans la section suivante._

![](../../.gitbook/assets/6%20%2814%29.png)

_**Remarque :**_ _dans ce cas, nous n’avons besoin que d’un seul nœud_ _**SendToFormIt**_ _, mais vous pouvez en créer plusieurs. Chacun d’eux crée un groupe dans FormIt, en fonction du nom du nœud_ _**SendToFormIt**_ _d’origine._

## **Nœuds SelectFromFormIt**

_Comme nous l’avons vu dans les chapitres précédents, les graphiques Dynamo peuvent inviter l’utilisateur à sélectionner une géométrie spécifique, qui est ensuite utilisée par le graphique. Nous allons maintenant ajouter deux \(2\) de ces nœuds au graphique d’escalier, de sorte que l’orientation, la largeur et la hauteur de l’escalier puissent être calculées à partir de la géométrie FormIt sélectionnée dans Dynamo._

1 – Supprimez l’escalier que vous venez de placer.

2 – Revenez à la fenêtre FormIt vide.

3 – Dans la **palette Dynamo**, cliquez sur la liste déroulante de la mosaïque **Stairs by Top Edge** (Escalier jusqu’au bord supérieur) et sélectionnez **Modifier le graphique source**. Le graphique s’ouvre à nouveau dans Dynamo.

_**Remarque :**_ _si vous modifiez un graphique Dynamo directement à partir de sa_ _**palette Propriétés**_ _en cliquant sur_ _**Modifier le graphique incorporé**_ _(au lieu de la_ _**palette Dynamo**\), vous modifiez le graphique incorporé pour ce groupe uniquement, et non le graphique source enregistré dans le dossier ajouté précédemment à la bibliothèque Dynamo de FormIt._

4 – Cette fois, nous souhaitons ajouter des nœuds de sélection, qui sont souvent situés près du début, ou du côté gauche, du graphique. Effectuez un zoom sur la zone illustrée ci-dessous.

![](../../.gitbook/assets/7%20%289%29.png)

5 – Pour ajouter les nouveaux nœuds de sélection, procédez comme suit :

1. Dans la zone **Modules complémentaires**, développez **FormIt** et cliquez deux fois sur **SelectFromFormIt**. Deux \(2\) nouveaux nœuds sont normalement créés au centre de l’écran.
2. Placez-les l’un au-dessus de l’autre, comme illustré dans l’image ci-dessous, créez un groupe orange pour eux et nommez-le **Geometry Selected from FormIt** (Géométrie sélectionnée depuis FormIt). L’ordre dans lequel l’utilisateur est invité à sélectionner des éléments dans FormIt est basé sur le positionnement vertical des nœuds de sélection dans Dynamo ; le nœud supérieur s’affiche en premier et le nœud inférieur en dernier.
3. Renommez le nœud supérieur **Select Top Edge** et le nœud inférieur **Select Bottom Floor**. Lorsque ce graphique est exécuté dans FormIt, l’Assistant Sélection Dynamo s’affiche et utilise les noms de ces nœuds comme invites pour la géométrie à sélectionner.
4. Cliquez avec le bouton droit de la souris sur chaque nœud et vérifiez que l’option **Est une entrée** est cochée. Elle est normalement sélectionnée par défaut, mais si ce n’est pas le cas, ces nœuds ne sont pas reconnus par FormIt.
5. Reliez les nouveaux nœuds de sélection comme illustrés dans l’image ci-dessous. Ils ne disposent que d’une \(1\) seule connexion chacun.

![](../../.gitbook/assets/8%20%2811%29.png)

_**Remarque :**_ _lorsque les nouveaux nœuds contiennent des avertissements, ils deviennent jaunes, comme illustré ci-dessus. Vous pouvez les ignorer pour l’instant. Les avertissements sont dus au fait que les nœuds attendent une géométrie de FormIt, mais n’en ont pas encore reçue \(car nous venons de les ajouter\)._

6 – Vous devez à présent apporter quelques modifications supplémentaires au graphique, de sorte que les escaliers soient créés à partir de la géométrie des nœuds de sélection. Tout d’abord, modifiez les entrées **Floor-to-Floor Height** et **Stair Width** afin que leurs valeurs proviennent de la géométrie sélectionnée plutôt que des curseurs d’entrée :

1. Tout en maintenant la touche **Maj** enfoncée, cliquez sur la sortie du nœud **Floor-to-Floor Height** dans le groupe orange **Slider Inputs** (Entrées des curseurs), puis déplacez ces fils vers la sortie du nœud **Calculated Floor-to-Floor Height** situé juste au-dessus.
2. En utilisant la même technique, déplacez les fils de sortie du nœud **Stair Width** dans le groupe orange **Slider Inputs** (Entrées des curseurs) vers la sortie du nœud **Calculated Floor-to-Floor Height** situé au-dessus.
3. Supprimez les anciens nœuds **Floor-to-Floor Height** et **Stair Width**, car vous n’en aurez plus besoin.

![](../../.gitbook/assets/9%20%288%29.png)

_**Remarque :**_ _si vous souhaitez ajouter des_ _nœuds d’entrée Dynamo à votre graphique, le processus est le même que pour ajouter les nœuds_ _**SelectFromFormIt**_ _. Assurez-vous simplement qu’ils portent la mention **Est une entrée**, renommez-les et réorganisez-les comme vous aimeriez qu’ils s’affichent dans FormIt. Ils apparaissent alors dans la_ _**palette Propriétés** de FormIt._

7 – Enfin, effectuez un zoom sur l’extrémité droite du graphique, où vous avez ajouté le nœud **SendToFormIt.Stairs** précédemment. Nous voulons que ce nœud de sortie utilise la géométrie de l’escalier qui a été déplacée et pivotée en fonction de la géométrie sélectionnée dans l’emplacement de FormIt. Pour ce faire, il suffit de passer du groupe **Stair Geometry** (Géométrie de l’escalier) au groupe **Rotated and Translated Stair Geometry** (Géométrie d’escalier pivotée et convertie).

![](../../.gitbook/assets/10%20%288%29.png)

## **Utilisation du graphique**

1 – Maintenant que vous avez ajouté les nœuds de sélection et d’ancrage, le graphique est prêt. Enregistrez et fermez Dynamo, puis revenez à la fenêtre FormIt avec le fichier **Encode Campus Sample Model.axm** et essayez de la façon suivante :

1. Assurez-vous que vous êtes toujours dans la scène **Section – Longitudinal** (Section – Longitudinale), puis tracez une ligne de 6 pi le long du bord droit de l’ouverture de l’escalier du premier étage. Cela permet de définir la largeur et l’angle de l’escalier.
2. Dans la **palette Dynamo**, cliquez sur la mosaïque **Stairs by Top Edge** (Escalier jusqu’au bord supérieur) pour démarrer le graphique.
3. L’Assistant Sélection Dynamo s’affiche et vous demande d’effectuer la première sélection à l’aide du nom donné à ce nœud de sélection précédemment : **Select Top Edge**. Une fois que vous avez sélectionné l’arête que vous venez de dessiner, cliquez sur la flèche droite dans l’Assistant Sélection Dynamo.
4. L’invite suivante indique le nom de l’autre nœud de sélection, **Select Bottom Floor**. Sélectionnez la dalle du rez-de-chaussée du bâtiment d’encodage principal, puis cliquez sur la coche.
5. Une fois l’escalier créé, notez que dans la **palette Propriétés**, vous avez désormais la possibilité de resélectionner la géométrie pour l’un des nœuds de sélection. Notez également que les curseurs correspondant aux nœuds d’entrée que vous avez supprimés, **Floor-to-Floor Height** et **Stair Width**, ne sont plus disponibles. Ils sont désormais calculés à partir de la géométrie sélectionnée.

![](../../.gitbook/assets/11%20%288%29.png)

_**Remarque :** si vous modifiez la position de l’arête supérieure ou la hauteur de l’étage inférieur, puis relancez le graphique, l’escalier est mis à jour en conséquence. Il est généralement recommandé d’éviter de déplacer manuellement une géométrie générée par Dynamo qui dépend des sélections FormIt, car cela peut modifier sa relation avec la géométrie sélectionnée utilisée pour la créer. Parfois, le regroupement du groupe Dynamo et de la géométrie de sélection permet de les maintenir connectés et d’éviter les problèmes._

2 – Pour finir, n’hésitez pas à personnaliser le graphique selon vos envies. Nous avons effectué les opérations suivantes à l’aide de différents outils décrits dans les chapitres précédents :

1. Création d’un escalier entre chaque étage.
2. Petite rotation de l’arête supérieure de l’escalier inférieur pour créer un escalier légèrement oblique vers le rez-de-chaussée.
3. Petit ajustement des curseurs d’entrée pour chaque escalier afin d’obtenir les paramètres souhaités.
4. Utilisation du graphique Dynamo **Railing Along Path** (Garde-corps le long du chemin) pour créer des paliers autour des ouvertures d’escalier.
5. Ajout d’un limon central pour chaque escalier à l’aide de l’outil **Balayage**.
6. Placement de l’ensemble des escaliers, des chaînes et des garde-corps sur un nouveau calque nommé **Encode Main Building – Stairs** (Bâtiment principal Encode – Escaliers).

![Escaliers terminés, vues en coupe.](../../.gitbook/assets/12%20%287%29.png)

![Escaliers finis, visibles à partir de la scène Eye Level &#x2013; Plaza (Au niveau du regard – Place).](../../.gitbook/assets/13%20%287%29.png)



