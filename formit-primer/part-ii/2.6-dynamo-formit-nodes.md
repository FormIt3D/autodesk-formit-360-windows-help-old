# 2.6 - Dynamo FormIt ノード

_FormIt には、FormIt と Dynamo の間でジオメトリを転送する Dynamo ノードのライブラリが用意されています。これまでの章で、Dynamo オブジェクトを作成し、FormIt 内で動的に調整する方法について説明しました。この章では、指定した Dynamo グラフを編集して、OOTB 階段グラフの修正バージョンを作成します。_

_この章では、モデル_ _**Encode Campus Sample Model.axm**_ _と_ _Dynamo スクリプト_ _**Stairs by Top Edge.dyn**_ _の両方を使用します。まだダウンロードしていない場合は、_ _**FormIt Primer Part 2 Dataset**をダウンロードすると、両方のファイルが見つかります。_

_FormIt で Dynamo を初めて使用する場合は、Primer_ _**Part 1**_ _の「_ _**1.10 -**_ _**Dynamo による計算グループ**_ _」の章を参照してください。この章では、Dynamo グラフの編集を行いますが、Dynamo の要素については、FormIt 固有のノードに関連する部分についてのみ説明します。Dynamo を初めて使用する場合は、_ [_**Dynamo Primer**_](https://primer.dynamobim.org/ja/01_Introduction/1-2_what_is_dynamo.html) _にアクセスして詳細を確認してください。_

_**このセクションでは、FormIt for Windows 2022.0 以降が必要になります。**_

## **Dynamo ライブラリの場所を追加する**

_FormIt では **Dynamo Samples** フォルダ内に OOTB グラフのライブラリが用意されていますが、独自のカスタム グラフを作成して保存する場所が必要です。これを行うには、まず、FormIt の **Dynamo ライブラリの場所**に新しいフォルダを追加します。これは、FormIt のコンテンツ ライブラリにフォルダを追加する場合と似ています。必要に応じて、Primer Part 1 の「**1.11 - コンテンツ ライブラリを使用してモデルを読み込む**」の章を参照してください。_

1 - 新しい **Dynamo ライブラリの場所**を追加するには、次のように操作します。

1. **Encode Campus Sample Model.axm** を開いた状態で、**[Dynamo]パレット**に移動します。
2. 左上コーナーの**[Dynamo フォルダをリンク]**ボタンをクリックします。
3. **[基本設定]**ウィンドウが開き、**[Dynamo]**タブが自動的に選択されます。新しい Dynamo ライブラリの場所を追加する**プラス**アイコンをクリックします。
4. **Encode Model Data Set** をダウンロードした場所にナビゲートし、**Supporting Files** 下の **FormIt Primer Graphs** フォルダを選択します。
5. **[フォルダを選択]**をクリックし、**[OK]**をクリックすると、FormIt に戻ります。
6. **[Dynamo]パレット**の上部にあるフォルダのドロップダウンで、先ほど追加した **FormIt Primer Graphs** フォルダを選択します。

![](../../.gitbook/assets/0%20%2821%29.png)

## **SendToFormIt** **ノード**

_Dynamo グラフを FormIt で使用するには、少なくとも 1 つの_ _**SendToFormIt**_ _ノードが必要です。_

1 - 最初は、先ほど追加したフォルダから、**Stair by Top Edge** グラフをそのまま使用します。

1. まず、シーン Section - Longitudinal に移動します。

2 - グラフに **SendToFormIt** ノードを追加します。これを行うには、新しい FormIt モデルで[ソース グラフを編集]を使用し、グラフ オーサリングの変更によって作業モデルが損なわれないようにします。

1. タスクバーの**[FormIt]アイコン**を右クリックし、**[FormIt]**を選択して新しい空の[FormIt]ウィンドウを起動します\(または[FormIt]アイコンを中マウス ボタンでクリックします\)。
2. **[Dynamo]パレット**で**[Stairs by Top Edge]**タイルを探し、タイルの右端にある小さなドロップダウン矢印をクリックするか、タイルを右クリックします。
3. **[ソース グラフを編集]**を選択します。Dynamo が自動的に起動し、編集するグラフが開きます。

![](../../.gitbook/assets/2%20%2822%29.png)

2 - Dynamo とグラフが開いたら、下図の右端にある緑色と紫色のグループが含まれている領域を拡大表示します。

![](../../.gitbook/assets/3%20%2819%29.png)

_**注:**_ _Dynamo グラフのフローの方向は左から右となっているため、通常はグラフの右端に出力ノードがあります。_

3 - ここでは、バックグラウンドで表示されている階段ジオメトリを FormIt モデルに送信するために、**SendToFormIt** ノードを追加します。

1. 左側の[アドオン\(パッケージ\)]のセクションで、**[FormIt]**ドロップダウンを展開し、**[SendToFormIt]**をクリックします。画面の中央に **SendToFormIt** ノードが表示されます。
2. 紫色のグループ **Send Stair Geometry to FormIt** に新しいノードを追加します。これを行うには、紫色のグループと新しい **SendToFormIt** ノードの両方を選択し、**SendToFormIt** ノードを右クリックして、**[グループに追加]**を選択します。下図に示す位置と同じような場所に新しいノードを移動します。
3. **SendToFormIt** ノードを右クリックして、**[出力]**がオンになっていることを確認します。これは既定でオンになっています。オンになっていないと、ジオメトリは FormIt に送信されません。
4. **SendToFormIt** ノードの名前を **SendToFormIt.Stairs** に変更します。
5. 下図に示すように、新しい **SendToFormIt.Stairs** ノードの 2 つの入力を接続します。

![](../../.gitbook/assets/4%20%2818%29.png)

_**注:**_ _ここでは、ジオメトリを FormIt にオブジェクトとして送信するかメッシュとして送信するかを決定する_ _**SetAsMesh**_ _オプション ノードのみを使用していますが、_ _使用可能な_ _**FormItGroupOptions**__ノードは多数あります。各オプション ノードは、FormIt に送信されるジオメトリのさまざまなプロパティをコントロールします。他のコントロールを自由に試してみてください。_

4 - FormIt に戻り、適切に送信されたかどうかを確認します。

1. Dynamo を保存して閉じます。更新されたグラフは、自動的に FormIt に再ロードされます。
2. **Encode Campus Sample File** を開いている FormIt ウィンドウに戻り、**[Dynamo]パレット**で**[Stair by Top Edge]**をもう一度クリックします。
3. 下図に示すように、モデルに階段を配置します。
4. 階段を選択し、グループ名が Dynamo グラフの名前と一致していることを確認してください。
5. ここで、グループを編集するためにダブルクリックし、ネストされた階段ジオメトリ グループを選択します。グループの名前が、Dynamo でノードに付けた名前と一致しています。

![](../../.gitbook/assets/5%20%2817%29.png)

_**注:**_ _階段の正確な位置を考慮する必要はありません。次のセクションで調整します。_

![](../../.gitbook/assets/6%20%2814%29.png)

_**注:**_ _この例では必要な_ _**SendToFormIt**_ _ノードは 1 つのみでしたが、複数作成することもできます。ノードごとに、元となった_ _**SendToFormIt**_ _ノードの名前に基づいて、1 つの新しいグループが FormIt で作成されます。_

## **SelectFromFormIt ノード**

_これまでの章で説明したように、Dynamo グラフでは特定のジオメトリを選択するようユーザに求めるプロンプトが表示され、そのジオメトリがグラフで使用されます。このようなノードを階段グラフに 2 つ追加します。これにより、Dynamo 内で階段の方向、幅、高さを、選択した FormIt ジオメトリから計算できるようになります。_

1 - 先ほど配置した階段を削除します。

2 - 空の FormIt ウィンドウに戻ります。

3 - **[Dynamo]パレット**で**[Stairs by Top Edge]**タイルのドロップダウンをクリックし、**[ソース グラフを編集]**を選択すると、また Dynamo で開きます。

_**注:**_ _Dynamo グラフを、_ _**[Dynamo]パレット**ではなく_ _**[プロパティ]パレット**_ _の_ _**[埋め込まれたグラフを編集]**_ _をクリックして直接編集すると、実際にはそのグループに埋め込まれたグラフのみを編集することになり、事前に FormIt の Dynamo ライブラリに追加したフォルダに保存されているソース グラフは編集されません。_

4 - 今回は、グラフの開始側、つまり左側付近に配置されることの多い選択ノードをいくつか追加します。下図に示されている領域を拡大表示します。

![](../../.gitbook/assets/7%20%289%29.png)

5 - 新しい選択ノードを追加します。

1. **[アドオン]**セクションで**[FormIt]**を展開し、**[SelectFromFormIt]**を 2 回クリックします。これで、画面の中央に新しいノードが 2 つ作成されます。
2. 下図に示すように、作成された 2 つを上下に配置し、オレンジ色のグループを作成して、「**Geometry Selected from FormIt**」という名前を付けます。FormIt で要素の選択を求めるプロンプトが表示される順序は、Dynamo での選択ノードの垂直方向の配置に基づきます。つまり、一番上のノードが最初に表示され、一番下のノードが最後に表示されます。
3. 上のノードの名前を「**Select Top Edge**」に、下のノードの名前を「**Select Bottom Floor**」に変更します。このグラフを FormIt で実行すると、Dynamo の選択ウィザードが表示され、ジオメトリを選択するためのプロンプトとして、これらのノードの名前が使用されます。
4. 各ノードを右クリックし、**[入力]**がオンになっていることを確認します。これは既定でオンになっています。オンになっていないと、ノードは FormIt に認識されません。
5. 下図に示すように、新しい選択ノードにワイヤで繋げます。各ノードの接続は 1 つのみです。

![](../../.gitbook/assets/8%20%2811%29.png)

_**注:**_ _新しいノードに警告が表示され、上図のように黄色に変わる場合があります。ここではこれらの警告を無視していただいて構いません。警告が表示されるのは、ノードが FormIt からのジオメトリを必要としているのにまだ受け取れていないからです\(ノードを追加したばかりであるため、これは仕方ありません\)._

6 - 選択ノードのジオメトリによって階段が作成されるよう、グラフに変更を加える必要があります。まず、**Floor-to-Floor Height** と **Stair Width** の入力を変更して、その値を入力スライダではなく、選択したジオメトリから取得するようにします。

1. **[Shift]**を押しながらオレンジ色のグループ **Slider Inputs** 内の **Floor-to-Floor Height** ノードの出力をクリックし、そのワイヤをすぐ上の **Calculated Floor-to-Floor Height** ノードの出力に移動します。
2. 同様に、オレンジ色のグループ **Slider Inputs** の **Stair Width** ノードの出力ワイヤを、上の **Stair Width** ノードの出力に移動します。
3. 古い **Floor-to-Floor Height** ノードと **Stair Width** ノードはもう必要ないため、削除します。

![](../../.gitbook/assets/9%20%288%29.png)

_**注:**_ _グラフへの_ _Dynamo 入力ノードの追加は、_ _**SelectFromFormIt**_ _ノードを追加する場合と非常に似ています。_ _**[入力]**とマークされていることを確認し、名前を変更して順序を変更します。ただし、FormIt で表示するように設定すると、FormIt の_ _**[プロパティ]パレット**に表示されます。_

7 - 最後に、先ほど **SendToFormIt.Stairs** ノードを追加したグラフの右端を表示します。この出力ノードを切り替え、FormIt の場所で選択したジオメトリに基づいて移動および回転された階段ジオメトリを使用するようにします。接続をグループ **Stair Geometry** からグループ **Rotated and Translated Stair Geometry** に切り替えるだけです。

![](../../.gitbook/assets/10%20%288%29.png)

## **グラフを使用する**

1 - 選択ノードとベイク処理ノードの両方を追加し、グラフの準備ができました。Dynamo を保存して閉じ、**Encode Campus Sample Model.axm** を開いている FormIt ウィンドウに戻り、次の方法で試します。

1. シーン **Section - Longitudinal** で作業していることを確認して、1 階の階段開口部の右エッジに沿って 6' の線を描画します。これで、階段の幅と角度が定義されます。
2. **[Dynamo]パレット**で**[Stairs by Top Edge]**タイルをクリックして、グラフを開始します。
3. Dynamo の選択ウィザードが表示され、先ほど選択ノードに付けた **Select Top Edge** という名前を使用して、最初の選択を行うように指示されます。先ほど描画したエッジを選択して、Dynamo の選択ウィザードで進む矢印をクリックします。
4. 次のプロンプトの名前は、もう一方の選択ノードの名前である **Select Bottom Floor** です。この建物の 1 階スラブを選択し、チェックマークをクリックします。
5. 階段が作成された後、選択ノードを選んでそのジオメトリを再選択するためのオプションが**[プロパティ]パレット**に表示されます。また、削除した入力ノード **Floor-to-Floor Height** および **Stair Width** に対応するスライダはなくなり、選択したジオメトリから計算されるようになりました。

![](../../.gitbook/assets/11%20%288%29.png)

_**注:** 上部エッジの位置または下部の床の高さを変更してグラフを再実行すると、それに応じて階段が更新されます。Dynamo で生成され、FormIt の選択に依存するジオメトリを手動で移動すると、作成に使用した選択済みジオメトリとの関係が変更される可能性があるため、通常はそのような移動を手動で行わないようにすることをお勧めします。Dynamo グループと選択ジオメトリをまとめてグループ化すると、接続を維持し、問題を回避できる場合があります。_

2 - 仕上げとして、自由に変更を加えます。これまでの章で説明したさまざまなツールを使用して、次のように変更しました。

1. 各階の間に階段を作成しました。
2. 階段最下部の上部エッジをわずかに回転させて、1 階に対してわずかに斜めの階段を作成しました。
3. 希望の設定にするために、各階段の入力スライダをわずかに調整しました。
4. Dynamo グラフの **Railing Along Path** を使用して、階段の開口部の周囲に踊り場を作成しました。
5. **スイープ**を使用して各階段に中央側桁を追加しました。
6. すべての階段、側桁、手摺を、**Encode Main Building - Stairs** という名前の新しいレイヤに配置しました。

![Finished stairs, views in section.](../../.gitbook/assets/12%20%287%29.png)

![Finished stairs, as visible from the Eye Level &#x2013; Plaza scene.](../../.gitbook/assets/13%20%287%29.png)



