# 2.6. Узлы FormIt в Dynamo

_В состав FormIt входит библиотека узлов Dynamo, с помощью которых можно переносить геометрию между FormIt и Dynamo. В предыдущих главах мы рассмотрели создание и динамическую корректировку объектов Dynamo в FormIt. В этой главе мы отредактируем имеющийся график Dynamo для создания модифицированной версии графика стандартной лестницы._

_В этой главе будет использована модель_ _**Encode Campus Sample Model.axm**_ _и_ _сценарий_ _**Stairs by Top Edge.dyn**_ _модуля Dynamo. Если вы еще этого не сделали, эти файлы можно скачать из_ _**набора данных к части II руководства FormIt Primer**._

_Если вы только начинаете использовать Dynamo в FormIt, рекомендуется предварительно прочитать главу_ _**1.10.**_ _**Вычислительные группы Dynamo**_ _в_ _**части I**_ _настоящего руководства. Хотя в этой главе рассматривается редактирование графиков Dynamo, речь идет только об элементах Dynamo, связанных с узлами для FormIt. Если вы еще не работали с Dynamo, дополнительные сведения можно найти на странице_ [_**Dynamo Primer**_](https://primer.dynamobim.org/ru/01_Introduction/1-2_what_is_dynamo.html)_**.**_

_**Для работы с этим разделом требуется FormIt for Windows 2022.0 или более поздней версии.**_

## **Добавление папки библиотеки Dynamo**

_Хотя FormIt содержит готовую к использованию библиотеку графиков в папке **Dynamo Samples**, необходимо место для создания и сохранения пользовательских графиков. Для этого сначала потребуется добавить новую **папку библиотеки Dynamo** в FormIt. Эта процедура аналогична добавлению папки в библиотеку компонентов FormIt \(см. главу **1.11. Импорт моделей с использованием Библиотеки компонентов** в части I данного руководства\)._

1 – Чтобы добавить **новую папку библиотеки Dynamo**, выполните следующие действия.

1. Откройте файл **Encode Campus Sample Model.axm** и перейдите на **палитру Dynamo**.
2. Нажмите кнопку **Привязать каталог Dynamo** в верхнем левом углу.
3. Откроется окно **Настройки** с автоматически выбранной вкладкой **Dynamo**. Щелкните значок «плюс» \(**Добавить новую папку библиотеки Dynamo**\).
4. Перейдите к папке, в которую был загружен **набор данных Encode Model**, и выберите папку **Supporting Files** &gt; **FormIt Primer Graphs**.
5. Нажмите **Выбрать папку**, а затем **ОК** для перехода назад в FormIt.
6. В раскрывающемся списке папок в верхней части **палитры Dynamo** выберите только что добавленную папку **FormIt Primer Graphs**.

![](../../.gitbook/assets/0%20%2821%29.png)

## **Узел** **SendToFormIt**

_Для работы с FormIt любой график Dynamo должен содержать хотя бы один узел_ _**SendToFormIt**_ _._

1 – Сначала попробуйте использовать график **Stair by Top Edge** из только что добавленной папки без внесения в него изменений.

1. Сначала перейдите к сцене Section — Longitudinal.

2 – Добавьте узел **SendToFormIt** в график. Для этого используйте инструмент «Редактировать исходный график» в новой модели FormIt, чтобы не вносить изменения в рабочую модель.

1. Щелкните правой кнопкой мыши значок **FormIt** на панели задач и выберите **FormIt**, чтобы открыть новое пустое окно FormIt \(или щелкните средней кнопкой мыши значок FormIt\).
2. На **палитре Dynamo** найдите миниатюру **Stairs by Top Edge** и щелкните небольшую стрелку раскрывающегося списка на правой кромке миниатюры или саму миниатюру правой кнопкой мыши.
3. Выберите команду **Редактировать исходный график**. Модуль Dynamo и график для редактирования откроются автоматически.

![](../../.gitbook/assets/2%20%2822%29.png)

2 – После открытия Dynamo и графика увеличьте область, показанную ниже, в крайней правой части которой находятся группы зеленого и фиолетового цветов.

![](../../.gitbook/assets/3%20%2819%29.png)

_**Примечание.**_ _Графики Dynamo выполняются слева направо, поэтому узлы вывода обычно расположены в правой части графика._

3 – Теперь необходимо добавить узел **SendToFormIt**, чтобы отправить геометрию лестницы, которая отображается на заднем плане, в модель FormIt.

1. В области «Надстройки» \(пакеты\) слева разверните раскрывающийся список **FormIt** и выберите **SendToFormIt**. В центре экрана отобразится узел **SendToFormIt**.
2. Добавьте новый узел в группу фиолетового цвета **Send Stair Geometry to FormIt**. Для этого выберите эту группу и новый узел **SendToFormIt**, а затем щелкните правой кнопкой мыши узел **SendToFormIt** и выберите команду **Добавить в группу**. Переместите новый узел в расположение, аналогичное показанному на изображении ниже.
3. Щелкните правой кнопкой мыши узел **SendToFormIt** и убедитесь, что установлен флажок **Является выводом**. Обычно он установлен по умолчанию, но если это не так, геометрия не будет отправлена в FormIt.
4. Переименуйте узел **SendToFormIt** в **SendToFormIt.Stairs**.
5. Подсоедините 2 \(два\) порта ввода нового узла **SendToFormIt.Stairs**, как показано на изображении ниже.

![](../../.gitbook/assets/4%20%2818%29.png)

_**Примечание.**_ _Хотя мы используем только узел параметров_ _**SetAsMesh**_, _который определяет, как геометрия будет отправлена в FormIt — в виде объекта или в виде сетки, —_ _доступно еще несколько узлов_ _**FormItGroupOptions**_ _. Каждый из них управляет различными свойствами геометрии, отправляемой в FormIt. Вы можете самостоятельно проверить, как работают другие узлы._

4 – Вернитесь в FormIt и проверьте результат.

1. Сохраните и закройте Dynamo. Обновленный график автоматически загрузится обратно в FormIt.
2. Вернитесь в окно FormIt с файлом **Encode Campus Sample** и на **палитре Dynamo** еще раз щелкните сценарий **Stairs by Top Edge**.
3. Разместите лестницу в модели, как показано на изображении ниже.
4. Выберите лестницу и обратите внимание, что имя ее группы совпадает с именем графика Dynamo.
5. Дважды щелкните группу, чтобы изменить ее, и выберите вложенную группу геометрии лестницы. Обратите внимание, что имя этой группы совпадает с именем, присвоенным узлу в Dynamo.

![](../../.gitbook/assets/5%20%2817%29.png)

_**Примечание.**_ _Не обращайте внимания на точность местоположения лестницы. Оно будет скорректировано в следующем разделе._

![](../../.gitbook/assets/6%20%2814%29.png)

_**Примечание.**_ _В данном случае требовался только один узел_ _**SendToFormIt**_ _, но можно создать несколько узлов. Каждый из них создаст новую группу в FormIt в соответствии с именем исходного узла_ _**SendToFormIt**_ _._

## **Узлы SelectFromFormIt**

_В предыдущих главах уже отмечалось, что графики Dynamo могут предлагать пользователю выбрать определенную геометрию, которая затем используется в графике. Добавьте 2 \(два\) узла в график лестницы, позволяющие рассчитать ориентацию, ширину и высоту лестницы в соответствии с выбранной геометрией FormIt в Dynamo._

1 – Удалите только что размещенную лестницу.

2 - Вернитесь в пустое окно FormIt.

3 - На **палитре Dynamo** щелкните раскрывающийся список миниатюры **Stairs by Top Edge** и выберите **Редактировать исходный график**. График снова откроется в Dynamo.

_**Примечание.**_ _При редактировании графика Dynamo непосредственно на_ _**палитре свойств**_ _путем выбора команды_ _**Редактировать исходный график**_ _\(а не на_ _**палитре Dynamo**\) изменяется только встроенный график для данной группы. Исходный график, сохраненный в папке, которая была ранее добавлена в библиотеку Dynamo в FormIt, остается неизменным._

4 – На этот раз необходимо добавить несколько узлов выбора, которые часто расположены ближе к началу \(левой стороне\) графика. Увеличьте область, показанную ниже.

![](../../.gitbook/assets/7%20%289%29.png)

5 – Чтобы добавить новые узлы выбора, выполните следующие действия.

1. В области **Надстройки** разверните элемент **FormIt** и дважды щелкните **SelectFromFormIt**, чтобы создать 2 \(два\) новых узла в центре экрана.
2. Расположите их один над другим, как показано на изображении ниже, создайте для них группу оранжевого цвета и присвойте ей имя **Geometry Selected from FormIt**. Порядок, в котором пользователю предлагается выбрать элементы в FormIt, продиктован вертикальным расположением узлов выбора в Dynamo. Верхний узел отображается первым, нижний — последним.
3. Измените имя верхнего узла на **Select Top Edge**, а нижнего узла на **Select Bottom Floor**. При запуске этого графика в FormIt отображается мастер выбора Dynamo, который использует имена этих узлов при запросе на выбор геометрии.
4. Щелкните правой кнопкой мыши каждый из узлов и убедитесь, что установлен флажок **Является вводом**. Флажок должен быть установлен по умолчанию, в противном случае эти узлы не будут распознаваться FormIt.
5. Подсоедините новые узлы выбора, как показано на изображении ниже. Каждый из них имеет только 1 \(одно\) соединение.

![](../../.gitbook/assets/8%20%2811%29.png)

_**Примечание.**_ _Новые узлы с предупреждениями обозначены желтым цветом \(см. изображение выше\). Пока их можно игнорировать. Предупреждения появляются из-за того, что узлы ожидают геометрию из FormIt, но еще не получили ее \(так как только что были добавлены\)._

6 – Теперь необходимо внести в график дополнительные изменения, требуемые для создания лестниц из геометрии, полученной узлами выбора. Сначала необходимо изменить порты ввода **Floor-to-Floor Height** и **Stair Width**, чтобы они получали значения из выбранной геометрии, а не из регуляторов ввода.

1. Нажав и удерживая клавишу **SHIFT**, щелкните порт вывода узла **Floor-to-Floor Height** внутри группы оранжевого цвета **Slider Inputs** и переместите провода к порту вывода узла **Calculated Floor-to-Floor Height**.
2. Таким же образом переместите провода вывода от узла **Stair Width** в группе **Slider Inputs** к расположенному выше порту вывода узла **Calculated Floor-to-Floor Height**.
3. Удалите старые узлы **Floor-to-Floor Height** и **Stair Width**, так как они больше не потребуются.

![](../../.gitbook/assets/9%20%288%29.png)

_**Примечание.**_ _Добавление_ _узлов ввода Dynamo в график аналогично добавлению узлов_ _**SelectFromFormIt**_ _. Убедитесь, что они имеют пометку_ _**Является вводом**, переименуйте и расположите их соответствующим образом для отображения в FormIt, после чего они появятся в_ _**палитре свойств** FormIt._

7 – Перейдите в правую часть графика, куда ранее был добавлен узел **SendToFormIt.Stairs**. Необходимо, чтобы этот узел вывода использовал геометрию лестницы, перемещенную и повернутую в соответствии с выбранной геометрией в FormIt. Вместо группы **Stair Geometry** подсоединитесь к группе **Rotated and Translated Stair Geometry**.

![](../../.gitbook/assets/10%20%288%29.png)

## **Использование графика**

1 - После добавления узлов выбора и обработки график будет готов к работе. Сохраните и закройте Dynamo, а затем вернитесь в окно FormIt с файлом **Encode Campus Sample Model.axm** и попробуйте выполнить следующие действия.

1. Убедитесь, что вы все еще находитесь в сцене **Section — Longitudinal**, и нарисуйте линию длиной 6 футов вдоль правого края проема лестницы первого этажа. Это позволит определить ширину и угол лестницы.
2. На **палитре Dynamo** щелкните миниатюру **Stairs by Top Edge**, чтобы начать построение графика.
3. Появится мастер выбора Dynamo с инструкциями о том, как сделать первый выбор, используя имя, которое было присвоено этому узлу выбора ранее: **Select Top Edge**. После выбора только что нарисованной кромки щелкните стрелку «вперед» в мастере выбора Dynamo.
4. Появится запрос с именем другого узла выбора — **Select Bottom Floor**. Выберите перекрытие первого этажа основного здания и щелкните флажок.
5. После создания лестницы обратите внимание на то, что на **палитре свойств** теперь можно повторно выбрать геометрию для любого из узлов выбора. Также обратите внимание на то, что регуляторы, соответствующие удаленным узлам ввода, а именно **Floor-to-Floor Height** и **Stair Width**, больше не отображаются. Теперь эти значения рассчитываются на основе выбранной геометрии.

![](../../.gitbook/assets/11%20%288%29.png)

_**Примечание.** При изменении положения верхней кромки или высоты нижнего перекрытия и повторном запуске графика лестницы обновляются соответствующим образом. Обычно рекомендуется избегать перемещения вручную сгенерированной в Dynamo геометрии, которая зависит от выбранных объектов FormIt, так как это может привести к изменению ее связи с выбранной геометрией, использованной для ее создания. Иногда можно сгруппировать выбранную геометрию и группы Dynamo, чтобы сохранить связь и избежать проблем._

2 – В завершение можно добавить собственные штрихи. С помощью различных инструментов, рассмотренных в предыдущих главах, вы выполнили следующее.

1. Создали лестницу между этажами.
2. Немного повернули верхнюю кромку нижней лестницы, чтобы расположить лестницу по диагонали к основному этажу.
3. Чтобы добиться нужных настроек, скорректировали некоторые регуляторы ввода для каждой лестницы.
4. С помощью графика Dynamo **Railing Along Path** создали лестничные площадки вокруг лестничных проемов.
5. Для каждой лестницы с помощью команды **Сдвиг** добавили центральный косоур.
6. Разместили все лестницы, косоуры и перила в новом слое с именем **Encode Main Building — Stairs**.

![Окончательная версия лестниц — виды в разрезе.](../../.gitbook/assets/12%20%287%29.png)

![Окончательная версия лестниц при просмотре в сцене Eye Level — Plaza.](../../.gitbook/assets/13%20%287%29.png)



