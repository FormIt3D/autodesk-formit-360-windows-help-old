# 2.6 - Nodos de Dynamo en FormIt

_FormIt incluye una biblioteca de nodos de Dynamo que transfieren geometría entre FormIt y Dynamo. En los capítulos anteriores, hemos visto cómo se pueden crear objetos de Dynamo y ajustarlos dinámicamente en FormIt. En este capítulo, editaremos un gráfico de Dynamo proporcionado para crear una versión modificada del gráfico de escalera OOTB._

_En este capítulo, utilizaremos el modelo_ _**Encode Campus Sample Model.axm**_ _y_ _la secuencia de comandos de Dynamo_ _**Stairs by Top Edge.dyn**_ _. Si aún no lo ha hecho, descargue el_ _**conjunto de datos de la parte 2 de FormIt Primer** para obtener estos dos archivos._

_Si es la primera vez que utiliza Dynamo en FormIt, es recomendable consultar el capítulo_ _**1.10 - **_ _**Grupo de cálculo con Dynamo**,_ _de la_ _**parte 1**_ _de FormIt Primer. Aunque este capítulo conllevará la edición de gráficos de Dynamo, solo abordaremos realmente elementos de Dynamo en relación con los nodos específicos de FormIt. Si es un nuevo usuario de Dynamo, puede obtener más información en_ [_**Dynamo Primer**_](https://primer.dynamobim.org/es/01_Introduction/1-2_what_is_dynamo.html)_**.**_

_**Necesitará FormIt para Windows 2022.0 o posterior en esta sección.**_

## **Adición de una ubicación de biblioteca de Dynamo**

_Aunque FormIt incluye una biblioteca de gráficos OOTB en la carpeta **Dynamo Samples**, necesitamos una ubicación para crear y guardar nuestros propios gráficos personalizados. Para ello, primero desearemos añadir una nueva carpeta a las **ubicaciones de bibliotecas de Dynamo** de FormIt. Esto es similar a añadir una carpeta a la biblioteca de contenido de FormIt. Si necesita un repaso, consulte el capítulo **1.11 - Importar modelos con la biblioteca de contenido** de la parte 1 de FormIt Primer._

1 – Para añadir una nueva **ubicación de biblioteca de Dynamo**, realice lo siguiente:

1. Con **Encode Campus Sample Model.axm** abierto, vaya a la **paleta Dynamo**.
2. Haga clic en el botón **Vincular directorio de Dynamo** en la esquina superior izquierda.
3. Se abrirá la ventana **Preferencias** con la ficha **Dynamo** seleccionada automáticamente. Haga clic en el icono más de **Añadir una nueva ubicación de biblioteca de Dynamo**.
4. Vaya a la ubicación en la que haya descargado el **conjunto de datos del modelo Encode** y seleccione la carpeta **Supporting Files** gt; **FormIt Primer Graphs**.
5. Haga clic en **Seleccionar carpeta** y, a continuación, en **Aceptar**; regresará a FormIt.
6. En el menú desplegable de la carpeta situada en la parte superior de la **paleta Dynamo**, seleccione la carpeta **FormIt Primer Graphs** que acabamos de añadir.

![](../../.gitbook/assets/0%20%2821%29.png)

## **Nodo** **SendToFormIt**

_Para cualquier gráfico de Dynamo que funcione con FormIt, debe tener al menos un nodo_ _**SendToFormIt**_ _._

1 - Probemos a utilizar primero el gráfico **Stair by Top Edge** tal cual, desde la carpeta que acabamos de añadir.

1. Vaya primero a la escena "Section - Longitudinal".

2 - Vamos a añadir el nodo **SendToFormIt** al gráfico. Para ello, vamos a utilizar la opción Editar gráfico de origen en un nuevo modelo de FormIt para no ensuciar el modelo de trabajo con los cambios de creación de gráficos.

1. Haga clic con el botón derecho en el **icono de FormIt** de la barra de tareas y seleccione **FormIt** para iniciar una nueva ventana vacía de FormIt \(o simplemente haga clic con el botón central en el icono de FormIt\).
2. En la **paleta Dynamo**, busque el mosaico **Stairs by Top Edge** y haga clic en la pequeña flecha de menú desplegable en el borde derecho del mosaico o haga clic con el botón derecho en el mosaico.
3. Seleccione **Editar gráfico de origen**. De este modo, se inicia Dynamo automáticamente y se abre el gráfico que se desea editar.

![](../../.gitbook/assets/2%20%2822%29.png)

2. Una vez que Dynamo y el gráfico se hayan abierto, amplíe la vista del área que se muestra a continuación, que contiene los grupos verde y púrpura más a la derecha.

![](../../.gitbook/assets/3%20%2819%29.png)

_**Nota:**_ _Los gráficos de Dynamo fluyen de izquierda a derecha, por lo que normalmente encontrará los nodos de salida en el extremo derecho del gráfico._

3 - Ahora es necesario añadir un nodo **SendToFormIt** para enviar la geometría de escalera que aparece en segundo plano al modelo de FormIt:

1. En el área Complementos \(paquetes\) de la izquierda, expanda el menú desplegable **FormIt** y haga clic en **SendToFormIt**. Aparecerá un nodo **SendToFormIt** en el centro de la pantalla.
2. Añada el nuevo nodo al grupo de color púrpura **Send Stair Geometry to FormIt**. Para ello, seleccione el grupo púrpura y el nuevo nodo **SendToFormIt** y, a continuación, haga clic con el botón derecho en el nodo **SendToFormIt** y seleccione **Añadir a grupo**. Mueva el nuevo nodo a una ubicación similar a la que se muestra en la imagen siguiente.
3. Haga clic con el botón derecho en el nodo **SendToFormIt** y asegúrese de que la opción **Se genera** esté activada. Debería estarlo por defecto, pero, si no lo está, no se enviará ninguna geometría a FormIt.
4. Cambie el nombre del nodo **SendToFormIt** a **SendToFormIt.Stairs**.
5. Conecte las dos \(2\) entrada del nuevo nodo **SendToFormIt.Stairs**, como se muestra en la imagen siguiente.

![](../../.gitbook/assets/4%20%2818%29.png)

_**Nota:**_ _Aunque solo se utiliza el nodo de opciones_ _**SetAsMesh**_ _, que determina si la geometría se envía a FormIt como un objeto o una malla,_ _hay una serie de nodos_ _**FormItGroupOptions**_ _disponibles. Cada uno de ellos controla varias propiedades de la geometría enviada a FormIt; no dude en experimentar con algunos de los otros._

4 - Volvamos a FormIt y veamos si funciona:

1. Guarde y cierre Dynamo. El gráfico actualizado se volverá a cargar automáticamente en FormIt.
2. Vuelva a la ventana de FormIt con **Encode Campus Sample File** y, en la **paleta Dynamo**, haga clic de nuevo en **Stair by Top Edge**.
3. Coloque la escalera en el modelo, como se muestra en la siguiente imagen.
4. Seleccione la escalera y observe que el nombre de grupo coincide con el nombre del gráfico de Dynamo.
5. A continuación, haga doble clic para editar el grupo y seleccione el grupo de geometría de escalera anidado. Observe que el nombre de ese grupo coincide con el nombre que asignamos al nodo en Dynamo.

![](../../.gitbook/assets/5%20%2817%29.png)

_**Nota:**_ _No se preocupe por la ubicación exacta de la escalera, la ajustaremos con precisión en la siguiente sección._

![](../../.gitbook/assets/6%20%2814%29.png)

_**Nota:**_ _En este caso, solo necesitamos un nodo_ _**SendToFormIt**_ _, pero puede crear varios. Cada uno de ellos creará un nuevo grupo en FormIt según el nombre del nodo_ _**SendToFormIt**_ _del que procede._

## **Nodos SelectFromFormIt**

_Como hemos visto en capítulos anteriores, los gráficos de Dynamo pueden solicitar al usuario que seleccione una geometría específica, que se utilizará a continuación en el gráfico. Ahora vamos a añadir dos \(2\) de estos nodos al gráfico de escalera para que la orientación, la anchura y la altura de las escaleras se puedan calcular a partir de la geometría de FormIt seleccionada dentro de Dynamo._

1 - Elimine la escalera que acabamos de colocar.

2 - Vuelva a la ventana FormIt vacía.

3. En la **paleta Dynamo**, haga clic en el menú desplegable del mosaico **Stairs by Top Edge** y seleccione **Editar gráfico de origen**, que se abrirá de nuevo en Dynamo.

_**Nota:**_ _Si edita un gráfico de Dynamo directamente desde su_ _**paleta Propiedades**_ _haciendo clic en la opción_ _**Editar gráfico incrustado**_ _\(en lugar de desde la_ _**paleta Dynamo**\), modificará el gráfico incrustado solo para ese grupo y no el gráfico de origen guardado en la carpeta que se ha añadido anteriormente a la biblioteca de Dynamo de FormIt._

4 - Esta vez, deseamos añadir algunos nodos de selección, que a menudo se encuentran cerca del comienzo o el lado izquierdo del gráfico. Amplíe la vista del área que se muestra a continuación.

![](../../.gitbook/assets/7%20%289%29.png)

5 - Para añadir los nuevos nodos de selección, realice lo siguiente:

1. En el área **Complementos**, expanda **FormIt** y haga clic dos veces en **SelectFromFormIt**; esta acción debería crear dos \(2\) nuevos nodos en el centro de la pantalla.
2. Organícelos uno encima del otro, como se muestra en la imagen siguiente, cree un grupo naranja para ellos y asígnele el nombre **Geometry Selected from FormIt**. El orden en el que se solicita al usuario que seleccione elementos en FormIt se basa en la posición vertical de los nodos de selección en Dynamo; el nodo superior se mostrará primero y el inferior, el último.
3. Cambie el nombre del nodo superior a **Select Top Edge** y el del nodo inferior a **Select Bottom Floor**. Cuando se ejecuta este gráfico en FormIt, aparece un Asistente de selección de Dynamo, que utilizará los nombres de estos nodos como solicitudes para la geometría que se va a seleccionar.
4. Haga clic con el botón derecho en cada nodo y asegúrese de que la opción **Es entrada** esté seleccionada. Debería estarlo por defecto, pero, si no lo está, FormIt no reconocerá estos nodos.
5. Conecte los nuevos nodos de selección, como se muestra en la imagen siguiente. Cada uno tiene una \(1\) conexión.

![](../../.gitbook/assets/8%20%2811%29.png)

_**Nota:**_ _Es posible que los nuevos nodos presenten advertencias, lo que provocará que se vuelvan amarillos, como se muestra arriba. Por ahora, puede omitirlas. Las advertencias se deben a que los nodos esperan geometría de FormIt, pero aún no la han recibido \(porque se acaba de añadir\)._

6 - Ahora es necesario realizar algunos cambios más en el gráfico para que las escaleras se creen a partir de la geometría de los nodos de selección. En primer lugar, es necesario cambiar las entradas **Floor-to-Floor Height** y **Stair Width** para que obtengan sus valores de la geometría seleccionada en lugar de hacerlo desde los controles deslizantes de entrada:

1. Mientras mantiene pulsada la tecla **Mayús**, haga clic en la salida del nodo **Floor-to-Floor Height** dentro del grupo **Controles deslizantes de entrada** naranja y desplace esos cables a la salida del nodo **Calculated Floor-to-Floor Height** justo encima.
2. Con la misma técnica, mueva los cables de salida del grupo **Stair Width** del grupo **Controles deslizantes de entrada** naranja a la salida del nodo **Calculated Floor-to-Floor Height** mostrado arriba.
3. Elimine los nodos **Floor-to-Floor Height** y **Stair Width** anteriores, ya que no los necesitaremos más.

![](../../.gitbook/assets/9%20%288%29.png)

_**Nota:**_ _Si desea añadir nodos de_ _entrada de Dynamo al gráfico, el proceso es muy similar al de añadir nodos_ _**SelectFromFormIt**_ _. Asegúrese de que estén marcados como_ _**Es entrada**, cambie el nombre y reordénelos tal y como desea que aparezcan en FormIt; se mostrarán en la_ _paleta Propiedades **de FormIt**._

7. Por último, amplíe la vista del extremo derecho del gráfico, donde hemos añadido anteriormente el nodo **SendToFormIt.Stairs**. Deseamos cambiar este nodo de salida para utilizar la geometría de escalera que se ha desplazado y rotado en función de la geometría seleccionada en la ubicación de FormIt. Solo tiene que cambiar la conexión del grupo **Stair Geometry** al grupo **Rotated and Translated Stair Geometry**.

![](../../.gitbook/assets/10%20%288%29.png)

## **Uso del gráfico**

1 - Ahora que hemos añadido nodos de selección y creación, el gráfico ya está listo. Guarde y cierre Dynamo y, a continuación, vuelva a la ventana de FormIt con **Encode Campus Sample Model.axm** abierto y realice lo siguiente para probarlo:

1. Asegúrese de que sigue en la escena **Section – Longitudinal** y, a continuación, dibuje una línea de 6' a lo largo del borde derecho del hueco de escalera de la primera planta. Esta acción definirá la anchura y el ángulo de la escalera.
2. En la **paleta Dynamo**, haga clic en el mosaico **Stairs by Top Edge** para iniciar el gráfico.
3. Aparecerá un Asistente de selección de Dynamo, que le indicará que realice la primera selección mediante el nombre asignado anteriormente a ese nodo de selección, **Select Top Edge**. Una vez que haya seleccionado el borde que acabamos de dibujar, haga clic en la flecha hacia delante del Asistente de selección de Dynamo.
4. A continuación, se solicitará el nombre del otro nodo de selección, **Select Bottom Floor**. Seleccione la losa de planta baja del edificio Encode principal y, a continuación, haga clic en la marca de verificación.
5. Una vez creada la escalera, observe que, en la **paleta Propiedades**, ahora tiene la opción de volver a seleccionar la geometría para cualquiera de los nodos de selección. Observe también que los controles deslizantes correspondientes a los nodos de entrada suprimidos, **Floor-to-Floor Height** y **Stair Width**, ya no están presentes; ahora se calculan a partir de la geometría seleccionada.

![](../../.gitbook/assets/11%20%288%29.png)

_**Nota:** Si cambia la posición del borde superior o la altura del suelo inferior y vuelve a ejecutar el gráfico, las escaleras se actualizarán en consecuencia. Normalmente es recomendable evitar el desplazamiento manual de la geometría generada por Dynamo que dependa de selecciones de FormIt, ya que esto puede cambiar su relación con la geometría seleccionada utilizada para crearla. En algunos casos, asociar de forma conjunta los grupos de Dynamo y la geometría de selección ayudará a mantenerlos conectados y a evitar problemas._

2 - Para terminar, no dude en añadir sus propios toques. Hemos realizado lo siguiente con diversas herramientas que se abordaron en capítulos anteriores:

1. Hemos creado una escalera entre cada planta.
2. Hemos rotado ligeramente el borde superior de la escalera inferior para crear una escalera ligeramente diagonal a la planta baja.
3. Hemos ajustado ligeramente algunos controles deslizantes de entrada para cada escalera a fin de obtener los parámetros deseados.
4. Hemos utilizado el gráfico de Dynamo **Railing Along Path** para crear descansillos alrededor de los huecos de escalera.
5. Hemos añadido una zanca central para cada escalera mediante la función **Barrido**.
6. Hemos colocado todas las escaleras, las cadenas y las barandillas en una nueva capa denominada **Encode Main Building – Stairs**.

![Escaleras acabadas mostradas en vistas en sección.](../../.gitbook/assets/12%20%287%29.png)

![Escaleras acabadas, tal y como se ven en la escena "Eye Level - Plaza".](../../.gitbook/assets/13%20%287%29.png)



